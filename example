# ============================================================
#  Ù†Ù…ÙˆØ°Ø¬ ØªØµÙ…ÙŠÙ… Ø´Ø¨ÙƒØ© Ø´Ø±ÙƒØ© AgriExport Ù„Ù„ØªØµØ¯ÙŠØ±
# Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„Ø®Ø·ÙŠØ© Ø§Ù„ØµØ­ÙŠØ­Ø© (MILP) Ø¹Ø¨Ø± Ù…ÙƒØªØ¨Ø© PuLP
# ============================================================

#  Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…ÙƒØªØ¨Ø©
from pulp import LpProblem, LpVariable, LpMinimize, lpSum, PULP_CBC_CMD, value

#  ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª
centers = ['Algiers', 'Oran', 'Annaba']   # Ø§Ù„Ù…Ø±Ø§ÙƒØ² Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø© (i)
markets = ['France', 'Italy', 'Spain']    # Ø§Ù„Ø£Ø³ÙˆØ§Ù‚ Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ© (j)

#  Ø§Ù„Ù…Ø¹Ø·ÙŠØ§Øª (Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª)
fixed_cost = {'Algiers': 80000, 'Oran': 70000, 'Annaba': 60000}   # fáµ¢
capacity = {'Algiers': 600, 'Oran': 400, 'Annaba': 500}           # sáµ¢
demand = {'France': 300, 'Italy': 350, 'Spain': 400}              # dâ±¼

# ØªÙƒÙ„ÙØ© Ø§Ù„Ø´Ø­Ù† (cáµ¢â±¼) Ù…Ù† ÙƒÙ„ Ù…Ø±ÙƒØ² Ø¥Ù„Ù‰ ÙƒÙ„ Ø³ÙˆÙ‚
cost = {
    'Algiers': {'France': 30, 'Italy': 35, 'Spain': 45},
    'Oran':    {'France': 35, 'Italy': 40, 'Spain': 30},
    'Annaba':  {'France': 40, 'Italy': 30, 'Spain': 35}
}

#  Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
model = LpProblem("AgriExport_Network_Design", LpMinimize)

# ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª
# xáµ¢â±¼ = ÙƒÙ…ÙŠØ© Ø§Ù„Ø³Ù„Ø¹ Ø§Ù„Ù…Ù†Ù‚ÙˆÙ„Ø© Ù…Ù† Ø§Ù„Ù…Ø±ÙƒØ² i Ø¥Ù„Ù‰ Ø§Ù„Ø³ÙˆÙ‚ j
x = LpVariable.dicts("x", [(i, j) for i in centers for j in markets], lowBound=0)

# yáµ¢ = 1 Ø¥Ø°Ø§ ØªÙ… ÙØªØ­ Ø§Ù„Ù…Ø±ÙƒØ² iØŒ Ùˆ0 Ø¥Ø°Ø§ Ù„Ù… ÙŠÙÙØªØ­
y = LpVariable.dicts("y", centers, lowBound=0, upBound=1, cat='Binary')

#  Ø¯Ø§Ù„Ø© Ø§Ù„Ù‡Ø¯Ù
# Minimize Z = Î£(i,j) cáµ¢â±¼ * xáµ¢â±¼ + Î£(i) fáµ¢ * yáµ¢
model += lpSum(cost[i][j] * x[(i, j)] for i in centers for j in markets) + \
          lpSum(fixed_cost[i] * y[i] for i in centers)

#  Ø§Ù„Ù‚ÙŠÙˆØ¯
# (1) ØªÙ„Ø¨ÙŠØ© Ø§Ù„Ø·Ù„Ø¨ ÙÙŠ ÙƒÙ„ Ø³ÙˆÙ‚ j
for j in markets:
    model += lpSum(x[(i, j)] for i in centers) == demand[j], f"Demand_{j}"

# (2) Ø¹Ø¯Ù… ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø³Ø¹Ø© ÙÙŠ ÙƒÙ„ Ù…Ø±ÙƒØ² i
for i in centers:
    model += lpSum(x[(i, j)] for j in markets) <= capacity[i] * y[i], f"Capacity_{i}"

#  Ø­Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
model.solve(PULP_CBC_CMD(msg=False))

# Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
print("==========  Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ø«Ù„Ù‰ ==========")
for i in centers:
    print(f"ÙØªØ­ Ø§Ù„Ù…Ø±ÙƒØ² {i}: {int(value(y[i]))}")

print("\n--- Ø§Ù„ÙƒÙ…ÙŠØ§Øª Ø§Ù„Ù…Ù†Ù‚ÙˆÙ„Ø© ---")
for i in centers:
    for j in markets:
        if value(x[(i, j)]) > 0:
            print(f"Ù…Ù† {i} Ø¥Ù„Ù‰ {j}: {value(x[(i, j)]):.2f} Ø·Ù†")

print("\n--- ğŸ”¢ Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ ---")
print(f"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ù…Ø«Ù„Ù‰ Z = {value(model.objective):,.2f} Ø¯Ø¬")

# ============================================================
# Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª
import networkx as nx
import matplotlib.pyplot as plt

# Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ
G = nx.DiGraph()

# Ø§Ù„Ø¹Ù‚Ø¯ (nodes)
warehouses = ['Algiers', 'Oran', 'Annaba']   # Ø§Ù„Ù…Ù†Ø´Ø¢Øª (Ø§Ù„Ù…ØµØ§Ù†Ø¹ Ø£Ùˆ Ø§Ù„Ù…Ø®Ø§Ø²Ù†)
markets = ['France', 'Italy', 'Spain']        # Ø§Ù„Ø²Ø¨Ø§Ø¦Ù† (Ø§Ù„Ø£Ø³ÙˆØ§Ù‚ Ø§Ù„Ù…Ø³ØªÙˆØ±Ø¯Ø©)

# Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù‚Ø¯
G.add_nodes_from(warehouses, bipartite=0)  # Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£ÙˆÙ„: Ø§Ù„Ù…Ù†Ø´Ø¢Øª
G.add_nodes_from(markets, bipartite=1)     # Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø«Ø§Ù†ÙŠ: Ø§Ù„Ø£Ø³ÙˆØ§Ù‚

# ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆØ§Ù‚Ø¹ ÙƒÙ„ Ø¹Ù‚Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø³Ù…
pos = {
    'Algiers': (-1, 0),
    'Oran': (0, 0),
    'Annaba': (1, 0),
    'France': (-1, -1),
    'Italy': (0, -1),
    'Spain': (1, -1)
}

# Ø§Ù„Ø±ÙˆØ§Ø¨Ø· (edges) ØªÙ…Ø«Ù„ ØªØ¯ÙÙ‚Ø§Øª Ø§Ù„Ø³Ù„Ø¹ Ø¨ÙŠÙ† Ø§Ù„Ù…Ù†Ø´Ø¢Øª ÙˆØ§Ù„Ø£Ø³ÙˆØ§Ù‚
edges = [
    ('Algiers', 'France', 80),
    ('Algiers', 'Italy', 40),
    ('Annaba', 'Spain', 60),
]

# Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ù…Ø¹ ØªØ³Ù…ÙŠØ§Øª (Ø§Ù„ÙƒÙ…ÙŠØ§Øª)
for i, j, qty in edges:
    G.add_edge(i, j, weight=qty)

# Ø±Ø³Ù… Ø§Ù„Ø¹Ù‚Ø¯
plt.figure(figsize=(8, 5))
nx.draw_networkx_nodes(G, pos, nodelist=warehouses, node_color='lightgreen', node_size=1500, label='Warehouses')
nx.draw_networkx_nodes(G, pos, nodelist=markets, node_color='skyblue', node_size=1500, label='Markets')

# Ø±Ø³Ù… Ø§Ù„Ø­ÙˆØ§Ù (Ø§Ù„Ø£Ø³Ù‡Ù…)
nx.draw_networkx_edges(G, pos, arrowstyle='->', arrowsize=20, edge_color='gray')

# Ø±Ø³Ù… Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø¹Ù‚Ø¯
nx.draw_networkx_labels(G, pos, font_size=12, font_weight='bold')

# Ø±Ø³Ù… Ø§Ù„Ù‚ÙŠÙ… (Ø§Ù„ÙƒÙ…ÙŠØ§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø­ÙˆØ§Ù)
edge_labels = {(i, j): f"{w} units" for i, j, w in edges}
nx.draw_networkx_edge_labels(G, pos, edge_labels=edge_labels, font_size=10)

# Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„ØªÙØ§ØµÙŠÙ„
plt.title(" AgriExport Logistics Network", fontsize=14)
plt.legend(scatterpoints=1)
plt.axis('off')
plt.show()
